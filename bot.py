import os
import requests
import telebot
from dotenv import load_dotenv

load_dotenv()

TELEGRAM_TOKEN = os.getenv("BOT_TOKEN")
OPENROUTER_API_KEY = os.getenv("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")

if not TELEGRAM_TOKEN or not OPENROUTER_API_KEY:
    raise ValueError("BOT_TOKEN –∏–ª–∏ OPENROUTER_API_KEY –Ω–µ –∑–∞–¥–∞–Ω—ã!")

bot = telebot.TeleBot(TELEGRAM_TOKEN)

OPENROUTER_API_URL = "https://openrouter.ai/api/v1/chat/completions"

@bot.message_handler(func=lambda message: True)
def generate_amigurumi(message):
    user_input = message.text

    prompt = f"""
    –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø—Ä–æ—Å—Ç—É—é –∏ –ø–æ–Ω—è—Ç–Ω—É—é —Å—Ö–µ–º—É –≤—è–∑–∞–Ω–∏—è –∞–º–∏–≥—É—Ä—É–º–∏ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–ø–∏—Å–∞–Ω–∏—é: {user_input}.
    –ù–∞—á–Ω–∏ —Å –∫–æ–ª—å—Ü–∞ –∞–º–∏–≥—É—Ä—É–º–∏, –æ–ø–∏—à–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –≥–æ–ª–æ–≤—É, —Ç—É–ª–æ–≤–∏—â–µ, —É—à–∏ –∏ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏.
    """

    try:
        headers = {
            "Authorization": f"Bearer {OPENROUTER_API_KEY}",
            "Content-Type": "application/json",
            "HTTP-Referer": "https://t.me/YourAmigurumiBot",  # üî• –£–ö–ê–ñ–ò –∑–¥–µ—Å—å —Å–≤–æ–π Telegram –±–æ—Ç/—Å–∞–π—Ç
            "X-Title": "YourAmigurumi",  # üî• –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏–ª–∏ —Å–∞–π—Ç–∞
        }

        payload = {
            "model": "qwen/qwen3-235b-a22b:free",
            "messages": [
                {"role": "user", "content": prompt}
            ],
            "temperature": 0.7,
            "max_tokens": 800
        }

        response = requests.post(OPENROUTER_API_URL, headers=headers, json=payload)
        response.raise_for_status()
        result = response.json()
        answer = result["choices"][0]["message"]["content"]

        bot.send_message(message.chat.id, answer)

    except Exception as e:
        bot.send_message(message.chat.id, f"–û—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    bot.polling()
